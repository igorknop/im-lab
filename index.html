<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script type="module">
        import Map from "./Map.js";
        const map = new Map();
        
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        map.canvas = canvas;
        map.ctx = ctx;
        document.body.appendChild(canvas);
        canvas.width = map.COLUMNS * map.SIZE;
        canvas.height = map.LINES * map.SIZE;

        function step(t) {
            map.dt = (t - map.to) / 1000;
            map.plot -= map.dt;
            if (map.plot < 0) {
                map.diffuse(0.02);
                map.swap();
                map.A[5][5] = 1.0;
                map.draw();
                map.plot = 0.02;
            }
            map.to = t;
            requestAnimationFrame(step);
        }
        
        canvas.addEventListener("mousemove", (e) => {
            if (map.drawing) {
                map.setValue(e);
            }
        });

        canvas.addEventListener("mousedown", (e) => {
            map.drawing = true;
        });
        canvas.addEventListener("mouseup", (e) => {
            map.drawing = false;
        });
        canvas.addEventListener("touchmove", (e) => {
            const touches = e.changedTouches;
            for (const key in touches) {
                if (touches.hasOwnProperty(key)) {

                    const touch = touches[key];
          
                    map.setValue(touch);
                }
            }
        });

       requestAnimationFrame(step);

    </script>
</body>

</html>