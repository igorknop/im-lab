<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script type="module">
        const SIZE = 5;
        const LINES = 50;
        const COLUMNS = 60;
        const D = 10.95; //Diffusion
        const F = 0.055;
        const K = 0.062;
        let dt = 0, to = 0, t = 0, plot = 0;
        let A = [];
        let B = [];
        for (let l = 0; l < LINES; l++) {
            A[l] = [];
            B[l] = [];
            for (let c = 0; c < COLUMNS; c++) {
                A[l][c] = 0;//Math.random();
                B[l][c] = 0;
            }
        }

        for (let l = LINES/2; l < LINES/2+3; l++) {
            for (let c = COLUMNS/2; c < COLUMNS/2+3; c++) {
                A[l][c] = 1.0;
            }
        }

        A[5][5] = 1.0;


        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        document.body.appendChild(canvas);
        canvas.width = COLUMNS * SIZE;
        canvas.height = LINES * SIZE;
        function draw() {
            for (let l = 0; l < LINES; l++) {
                for (let c = 0; c < COLUMNS; c++) {
                    ctx.fillStyle = `hsl(120,100%,${(1-A[l][c]) * 100}%)`;
                    ctx.fillRect(c * SIZE, l * SIZE, SIZE, SIZE);
                }
            }
        }
        function diffuse(dt) {

            for (let l = 0; l < LINES; l++) {
                for (let c = 0; c < COLUMNS; c++) {
                    const a = A[l][c];
                    B[l][c] = a + (D*laplace(l, c) - K*a) * dt;
                }
            }
        }
        function swap() {
            let C = A;
            A = B;
            B = C;
        }

        function step(t) {
            dt = (t - to) / 1000;
            plot -= dt;
            if (plot < 0) {
                diffuse(0.1);
                swap();
                A[5][5] = 1.0;
                draw();
                plot = 0.2;
            }
            to = t;
            requestAnimationFrame(step);
        }

        function laplace(l, c) {
            const OC = 0.2;
            const DC = 0.05
            let sum = 0;
            if (l - 1 > 0) sum += A[l - 1][c] * OC;
            if (l + 1 < LINES) sum += A[l + 1][c] * OC;
            if (c - 1 > 0) sum += A[l][c - 1] * OC;
            if (c + 1 < COLUMNS) sum += A[l][c + 1] * OC;
            if (l - 1 > 0 && c - 1 > 0) sum += A[l - 1][c - 1] * DC;
            if (l - 1 > 0 && c + 1 < COLUMNS) sum += A[l - 1][c + 1] * DC;
            if (l + 1 < LINES && c - 1 > 0) sum += A[l + 1][c - 1] * DC;
            if (l + 1 < LINES && c + 1 < COLUMNS) sum += A[l + 1][c + 1] * DC;

            sum += A[l][c] * -1;
            
            return sum;
        }

        canvas.addEventListener("click",(e)=>{
            const box = e.target.getBoundingClientRect();
            const x = e.clientX - box.left;
            const y = e.clientY - box.top;
            const l = Math.floor(y/SIZE);
            const c = Math.floor(x/SIZE);
            A[l][c] = 1.0;
        });

        requestAnimationFrame(step);

    </script>
</body>

</html>